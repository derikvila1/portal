<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
<link rel="stylesheet" href="./agenda.module.css">
<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0, maximum-scale=10, minimum-scale=1.0">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20,400,1,0" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

<!doctype html>

<html>

<head>

    <meta charset="utf-8" />
    <title>Calendário jQuery</title>

</head>

<body>
    <div class="divP">
        <div>
            <p class="diretorio">Inicio > Agenda</p>
            <h1 class="tituloAgenda">Agenda</h1>
            <div class="Dflex">
                <h3 onclick="ToggleExibicao('Evento')" class="agendaEventos active">Eventos</h3>
                <h3 onclick="ToggleExibicao()"class="agendaExposicoes">Exposições</h3>
            </div>
            <div class="divCal">
                <form class="divCalForm">
                    <h3 class="divCalPeriodo">Período</h3>
                    <input onclick="mudaTipo('hoje'), mostraEvento(diaGlobal)"  class="divCalCheck" type="radio" id="hoje" name="date_type" value="hoje">
                    <label class="divCalLab" for="hoje">Hoje</label><br>
                    <input onclick="mudaTipo('seteDias'), mostraEvento(diaGlobal)" checked="true" class="divCalCheck" type="radio" id="prox_7_dias" name="date_type" value="prox_7_dias">
                    <label class="divCalLab" for="prox_7_dias">Próximos 7 dias</label><br>
                    <input onclick="mudaTipo('trintaDias'), mostraEvento(diaGlobal)" class="divCalCheck" type="radio" id="prox_30_dias" name="date_type" value="prox_30_dias">
                    <label class="divCalLab" for="prox_30_dias">Próximos 30 dias</label>
                </form>
                <form class="ExibicaoFiltro">
                    <h3 class="divCalPeriodo">Período</h3>
                    <input class="divCalCheck" type="radio" id="emCartaz" name="filtroExib" value="emCartaz">
                    <label class="divCalLab" for="emCartaz">Em Cartaz</label><br>
                    <input class="divCalCheck" type="radio" id="permanentes" name="filtroExib" value="permanentes">
                    <label class="divCalLab" for="permanentes">Permanentes</label><br>
                </form>
                <div class='divCalendario'>
                    <div onchange="mudaDia(value), mostraEvento(value)" id="calendario"></div>

                </div>

                <div class="Generos">
                    <h3 class="divCalPeriodo">Generos</h3>
                    <div class="divCalGenerosCK">
                        <form>
                            <input type="radio" id="todos" onclick="mudaTipoCategoria(value), mostraEvento(diaGlobal)"  name="category" value="Todos" checked="true">
                            <label class="divCalLab" for="todos">Todos</label><br>
                            <input type="radio" id="musica" onclick="mudaTipoCategoria(value), mostraEvento(diaGlobal)" name="category" value="Música" >
                            <label class="divCalLab" for="musica">Música</label>
                            <input type="radio" id="teatro" onclick="mudaTipoCategoria(value), mostraEvento(diaGlobal)" name="category" value="Teatro">
                            <label class="divCalLab" for="teatro">Teatro</label><br>
                            <input type="radio" id="danca" onclick="mudaTipoCategoria(value), mostraEvento(diaGlobal)" name="category" value="Dança">
                            <label class="divCalLab" for="danca">Dança</label>
                            <input type="radio" id="palestra" onclick="mudaTipoCategoria(value), mostraEvento(diaGlobal)" name="category" value="Palestra">
                            <label class="divCalLab" for="palestra">Palestra</label>
                            
                        </form>
                    </div>
                </div>
                <div class="Localck">
                    <h3 class="divCalLocal">Local</h3>
                    <div class="divCalLocalCK">
                        <form class="localsp">
                            <div>
                                <input type="radio" id="palaceteProvincial" name="local" value="palaceteProvincial" >
                                <label class="divCalLab" for="palaceteProvincial">Palacete Provincial</label><br>
                                <input type="radio" id="palacioRioNegro" name="local" value="palacioRioNegro">
                                <label class="divCalLab" for="palacioRioNegro">Palácio Rio Negro</label>
                                <input type="radio" id="palacioDaJustica" name="local" value="palacioDaJustica">
                                <label class="divCalLab" for="palacioDaJustica">Palácio da Justiça</label><br>
                                <input type="radio" id="povosDaAmazonia" name="local" value="povosDaAmazonia">
                                <label class="divCalLab" for="povosDaAmazonia">Povos da Amazônia</label>
                                <input type="radio" id="usinaChaminé" name="local" value="usinaChaminé">
                                <label class="divCalLab" for="usinaChaminé">Usina Chaminé</label>
                                
                            </div>
                            <div>
                                <input type="radio" id="casaDasArtes" name="local" value="casaDasArtes">
                                <label class="divCalLab" for="casaDasArtes">Casa das Artes</label>
                                <input type="radio" id="galeriaDoLargo" name="local" value="galeriaDoLargo">
                                <label class="divCalLab" for="galeriaDoLargo">Galeria do Largo</label>
                                <input type="radio" id="sambodromoLiceu" name="local" value="sambodromoLiceu">
                                <label class="divCalLab" for="sambodromoLiceu">Sambódromo - Liceu</label>
                                <input type="radio" id="TeatroGebesMedeiro" name="local" value="TeatroGebesMedeiro">
                                <label class="divCalLab" for="TeatroGebesMedeiro">Teatro Gebes Medeiros</label>
                                <input type="radio" id="TeatroAmazonas" name="local" value="TeatroAmazonas">
                                <label class="divCalLab" for="TeatroAmazonas">Teatro Amazonas</label>
                        </div>
                        </form>
                    </div>
                </div>
            </div>



        </div>


    </div>

    <div class="mainDiv"  id="divCard">

    </div>
    <div class="ExibicaoPage">
        <div class="ExibicaoCard">
            <div class="ExibicaoImg">
    
            </div>
            <div class="ExibicaoInf">
                <p class="ExibicaoSubtitulo">Exposição Fotografica</p>
                <p class="ExibicaoTitulo">Chão Velho</p>
                <p class="ExibicaoDescricao">Lorem Ipsum is simply dummy text of the printing and 
                    typesetting industry. Lorem Ipsum has been the industry's standard dummy text 
                    ever since the 1500s, when an unknown printer took a galley of type and scrambled
                    it to make a type specimen book. It has survived not only five centuries, but 
                    also the leap into electronic typesetting</p>
                <div class="ExibicaoDataHora">
                    <p class="ExibicaoData"><span class="material-symbols-outlined Exibicaoicons">event_upcoming</span>A partir de 28 de agosto , terça a sabado</p>
                    <p class="ExibicaoHora"><span class="material-symbols-rounded Exibicaoicons">schedule</span>9h ás 15h</p>
                </div>
                <p class="ExibicaoLocal"><span class="material-symbols-rounded Exibicaoicons">location_on</span>Palacete Provincial</p>
            </div>
        </div>
        <div class="ExibicaoCard">
            <div class="ExibicaoImg">
    
            </div>
            <div class="ExibicaoInf">
                <p class="ExibicaoSubtitulo">Exposição Fotografica</p>
                <p class="ExibicaoTitulo">Chão Velho</p>
                <p class="ExibicaoDescricao">Lorem Ipsum is simply dummy text of the printing and 
                    typesetting industry. Lorem Ipsum has been the industry's standard dummy text 
                    ever since the 1500s, when an unknown printer took a galley of type and scrambled
                    it to make a type specimen book. It has survived not only five centuries, but 
                    also the leap into electronic typesetting</p>
                <div class="ExibicaoDataHora">
                    <p class="ExibicaoData"><span class="material-symbols-outlined Exibicaoicons">event_upcoming</span>A partir de 28 de agosto , terça a sabado</p>
                    <p class="ExibicaoHora"><span class="material-symbols-rounded Exibicaoicons">schedule</span>9h ás 15h</p>
                </div>
                <p class="ExibicaoLocal"><span class="material-symbols-rounded Exibicaoicons">location_on</span>Palacete Provincial</p>
            </div>
        </div>
        <div class="ExibicaoCard">
            <div class="ExibicaoImg">
    
            </div>
            <div class="ExibicaoInf">
                <p class="ExibicaoSubtitulo">Exposição Fotografica</p>
                <p class="ExibicaoTitulo">Chão Velho</p>
                <p class="ExibicaoDescricao">Lorem Ipsum is simply dummy text of the printing and 
                    typesetting industry. Lorem Ipsum has been the industry's standard dummy text 
                    ever since the 1500s, when an unknown printer took a galley of type and scrambled
                    it to make a type specimen book. It has survived not only five centuries, but 
                    also the leap into electronic typesetting</p>
                <div class="ExibicaoDataHora">
                    <p class="ExibicaoData"><span class="material-symbols-outlined Exibicaoicons">event_upcoming</span>A partir de 28 de agosto , terça a sabado</p>
                    <p class="ExibicaoHora"><span class="material-symbols-rounded Exibicaoicons">schedule</span>9h ás 15h</p>
                </div>
                <p class="ExibicaoLocal"><span class="material-symbols-rounded Exibicaoicons">location_on</span>Palacete Provincial</p>
            </div>
        </div>
    </div>


</body>

</html>


<script>
    let tipoPeriodo = ""
    let diaGlobal =  ""
    let tipoCategoria = "Todos"

    $('.ExibicaoPage').hide()
    $('.Local').hide()

    let EventoButton = $('.agendaEventos')
    let ExibicaoButton = $('.agendaExposicoes')

    ToggleExibicao('Evento')
    
    function ToggleExibicao(who){
        if (who == 'Evento'){
            //div cards
            $('.mainDiv').show()
            //card exibicao
            $('.ExibicaoPage').hide()
            //barinha no Eventos e  Exposições
            EventoButton.addClass("active")
            ExibicaoButton.removeClass("active")
            // Esconder check de local e aparecer de generos
            $('.Generos').show()
            $('.Localck').hide()
            //Perildo inputs
            $('.ExibicaoFiltro').hide()
            $('.divCalForm').show()
        }
        else{
            // Aparecer check de local e Esconder de generos
            $('.Generos').hide()
            $('.Localck').show()
            //div cards
            $('.mainDiv').hide()
            //div exibicao
            $('.ExibicaoPage').show()
            //barinha no Eventos e  Exposições
            ExibicaoButton.addClass("active")
            EventoButton.removeClass("active")
            //Perildo inputs
            $('.ExibicaoFiltro').show()
            $('.divCalForm').hide()
        }
    }
    function mudaTipo(tipo){
        tipoPeriodo = tipo
    }

    function mudaDia(value){
        diaGlobal = value
        console.log(diaGlobal)
        console.log(value)
    }

    function mudaTipoCategoria(categoria){
        tipoCategoria = categoria
    }

    var obj = {}
    let i = 0 
    function mostraEvento(value) {
        let html = '';
        var dias = value.split('/')
    
        if(tipoPeriodo == "hoje"){

            rawData = agenda_local(dias[0], dias[1], dias[2])
        }
        if(tipoPeriodo == "seteDias"){

        rawData = buscaSeteDias(dias[0], dias[1], dias[2])
        }
        if(tipoPeriodo == "trintaDias"){

        rawData = buscaTrintaDias(dias[0], dias[1], dias[2])
        }




        rawData.forEach(element => {
            var monthNames= ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro']
            const raw =  Object.values(element.espaco)
           const objraw = raw[0]
           const nomeEspaco = objraw.espaco
           const titulo = element.titulo
           const dataraw = Object.keys(objraw.agenda)
           var teste = dataraw[0].split('-')
           var ts = Object.values(objraw.agenda)
           ts = ts[0]
           ts= ts[0]
           ts = ts.hora_inicio
           ts= ts.split(':')
           const faixaEtaria = element.classificacao
            const faixaEtaria2 = faixaEtaria.split(" ")
            let faixaEtaria3 = ""
            let listaCores = ["#6667ab","#003e15","#dc4011","#5e3f32","#e25989","#fba612","#58cad4","#6667ab","#003e15"]

         if(faixaEtaria2[0] === "Livre"){
            faixaEtaria3 = "livre"
         }
         else{
            if(faixaEtaria2[5] == "seis"){
                faixaEtaria3 = 'menores_6'
            }
            if(faixaEtaria2[5] == "dez"){
                faixaEtaria3 = 'menores_10'
            }
            if(faixaEtaria2[5] == "doze"){
                faixaEtaria3 = 'menores_12'
            }
            if(faixaEtaria2[5] == "catorze"){
                faixaEtaria3 = 'menores_14'
            }
            if(faixaEtaria2[5] == "dezesseis"){
                faixaEtaria3 = 'menores_16'
            }
            if(faixaEtaria2[5] == "dezoito"){
                faixaEtaria3 = 'menores_18'
            }
         }
         
         if(i < 8){
            i++
         }
         else{
            i=0
         }

        console.log(element.category)
        
        if(tipoCategoria == "Todos"){

            html += `<div>
                <div class="divCardT">
                    <div style="background-image: url(https://sistemas.cultura.am.gov.br${element.imagem_banner});"
                    class="divCardBack">
                    </div>
                    <div class="Cardif">
                        <div style='background-color:${listaCores[i]};' class="CardDual">
                            <div>
                                <h3 class="titulo">${titulo}</h3>
                                <div class="icons">
                                    <span class="material-symbols-rounded">bookmark</span>
                                    <p class="categoria">${element.category}</p>
                                </div>
                                <div class="dateAndTime">
                                    <div class="icons datetime">
                                        <span class="material-symbols-outlined icon-d">event_upcoming</span>
                                        <p class="data">${teste[2]} ${monthNames[parseInt(teste[1])-1]} ${teste[0]}</p>
                                    </div>
                                    <div class="icons datetime">
                                        <span class="material-symbols-rounded icon-d">schedule</span>
                                        <p class="hora">${ts[0]}h</p>
                                    </div> 
                                </div>
                                <div class="icons">
                                    <span class="material-symbols-rounded">location_on</span>
                                    <p class="local">${nomeEspaco}</p>
                                </div>

                                <div class="classif">
                                    <span class="material-symbols-rounded fixp">paid</span><p class="preco">${element.price === "000"? "Evento gratuito": "Evento pago"}</p>
                                    <img class="clasificacao" src="https://sistemas.cultura.am.gov.br/sigec/themes/sigec/img/classificacao/${faixaEtaria3}.png" alt="">
                                </div>

                                <div >
                                    <p class="descricao"></p>
                                    </div>
                            </div>
                            <div class="expand" onmouseover="show()" onmouseleave="hide()">
                                <div>
                                    <p class='moreif'><span class="material-symbols-outlined">add_circle</span>Mais Informações</p>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`
        }else{
            if(element.category == tipoCategoria){
                html += `<div>
                <div class="divCardT">
                    <div style="background-image: url(https://sistemas.cultura.am.gov.br${element.imagem_banner});"
                    class="divCardBack">
                    </div>
                    <div class="Cardif">
                        <div style='background-color:${listaCores[i]};' class="CardDual">
                            <div>
                                <h3 class="titulo">${titulo}</h3>
                                <div class="icons">
                                    <span class="material-symbols-rounded">bookmark</span>
                                    <p class="categoria">${element.category}</p>
                                </div>
                                <div class="dateAndTime">
                                    <div class="icons datetime">
                                        <span class="material-symbols-outlined icon-d">event_upcoming</span>
                                        <p class="data">${teste[2]} ${monthNames[parseInt(teste[1])-1]} ${teste[0]}</p>
                                    </div>
                                    <div class="icons datetime">
                                        <span class="material-symbols-rounded icon-d">schedule</span>
                                        <p class="hora">${ts[0]}h</p>
                                    </div> 
                                </div>
                                <div class="icons">
                                    <span class="material-symbols-rounded">location_on</span>
                                    <p class="local">${nomeEspaco}</p>
                                </div>

                                <div class="classif">
                                    <p class="preco"><span class="material-symbols-rounded">paid</span>${element.price === "000"? "Evento gratuito": "Evento pago"}</p>
                                    <img class="clasificacao" src="https://sistemas.cultura.am.gov.br/sigec/themes/sigec/img/classificacao/${faixaEtaria3}.png" alt="">
                                </div>

                                <div >
                                    <p class="descricao"></p>
                                    </div>
                            </div>
                            <div class="expand" onmouseover="show()" onmouseleave="hide()">
                                <div>
                                    <p class='moreif'><span class="material-symbols-outlined">add_circle</span>Mais Informações</p>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`
            }
        }


        });
        document.getElementById('divCard').innerHTML = (html.length > 0) ? html : null;
    }

    function agenda_local(dia, mes, ano) {
        const {
            pautas
        } = obj;
        console.log(dia, mes, ano);
        //console.log(pautas)
        const filterData = Object.values(pautas)
            .filter(pauta => {
                const controleEspaco = Object.values(pauta.espaco).filter(espaco => {
                    const controleAgenda = Object.keys(espaco.agenda).filter(data => data === `${ano}-${mes}-${dia}`);
                    return controleAgenda.length;
                });
                return controleEspaco.length;
            })
        console.log(filterData);

        return filterData;
    }

    function buscaSeteDias(dia, mes, ano) {
        var hoje = new Date
            // var diaHoje = hoje.getDay
            // var mesHoje = hoje.getMonth
        var diaHoje = "15"
        var mesHoje = "06"
        var hojeInteiro = parseInt(diaHoje);

        const {
            pautas
        } = obj;
        const filterData = Object.values(pautas)
            .filter(pauta => {
                const controleEspaco = Object.values(pauta.espaco).filter(espaco => {
                    const controleAgenda = Object.keys(espaco.agenda).filter(data => data > `${ano}-${mesHoje}-${(hojeInteiro - 1).toString()}`).filter(data => data <= `${ano}-${mesHoje}-${(hojeInteiro + 8).toString()}`);
                    return controleAgenda.length;
                });
                return controleEspaco.length;
            })
        console.log(filterData);

        return filterData;
    }

    function buscaTrintaDias(dia, mes, ano) {
        var hoje = new Date
        var diaHoje = hoje.getDay
        var mesHoje = hoje.getMonth

        var hojeInteiro = parseInt(diaHoje);
        var mesInteiro = parseInt(mesHoje);

        const {
            pautas
        } = obj;
        const filterData = Object.values(pautas)
            .filter(pauta => {
                const controleEspaco = Object.values(pauta.espaco).filter(espaco => {
                    const controleAgenda = Object.keys(espaco.agenda).filter(data => data > `${ano}-${mesHoje}-${(hojeInteiro - 1).toString()}`).filter(data => data <= `${ano}-${(mesInteiro + 1).toString()}-${(diaHoje)}`);
                    return controleAgenda.length;
                });
                return controleEspaco.length;
            })
        console.log(filterData);

        return filterData;
    }

    window.onload = async function loadContent() {

        await jQuery.ajax({
            url: 'https://sistemas.cultura.am.gov.br/sigec/api/ListarPautas?type=year&val1=2022',
            data: {
                format: 'json'
            },
            error: function (error) {
                console.log('error', error);
            },
            dataType: 'json',
            success: function (data) {
                Object.assign(obj, data);
                console.log("ok")
            },
            type: 'GET'
        });

        diaGlobal = getDate()
        mudaTipo('seteDias')
        mostraEvento(diaGlobal)
    }
    
function getDate(){
        let today = new Date
        day = today.getDate()
        month = today.getMonth() +1
        year = today.getFullYear()
        result = day+"/"+month+"/"+year
    return result;
}

    $(function () {
        $("#calendario").datepicker({
            
            dayNamesMin: $.datepicker._defaults.dayNamesShort,
            dateFormat: 'dd/mm/yy',
            dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'],
            //  dayNamesMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S', 'D'],
            dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
            monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
            monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
        });
    });
</script>
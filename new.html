<link rel="stylesheet" href="http://code.jquery.com/ui/1.9.0/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
<script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
<link rel="stylesheet" href="./agenda.module.css">

<!doctype html>

<html>

<head>

    <meta charset="utf-8" />
    <title>Calendário jQuery</title>

</head>

<body>
    <div class="divP">
        <div>
            <p class="diretorio">Inicio > Agenda</p>
            <h1 class="tituloAgenda">Agenda</h1>
            <div class="Dflex">
                <h3 class="agendaEventos active">Eventos</h3>
                <h3 class="agendaEventos">Exposições</h3>
            </div>
            <div class="divCal">
                <form class="divCalForm">
                    <h3 class="divCalPeriodo">Período</h3>
                    <input class="divCalCheck" type="radio" id="hoje" name="date_type" value="hoje">
                    <label class="divCalLab" for="hoje">Hoje</label><br>
                    <input class="divCalCheck" type="radio" id="prox_7_dias" name="date_type" value="prox_7_dias">
                    <label class="divCalLab" for="prox_7_dias">Próximos 7 dias</label><br>
                    <input class="divCalCheck" type="radio" id="prox_30_dias" name="date_type" value="prox_30_dias">
                    <label class="divCalLab" for="prox_30_dias">Próximos 30 dias</label>

                </form>
                <div class='divCalendario'>
                    <div onchange="mostraEvento(value)" id="calendario"></div>

                </div>

                <div>
                    <h3 class="divCalPeriodo">Generos</h3>
                    <div class="divCalGenerosCK">
                        <form>
                            <input type="radio" id="musica" name="category" value="musica" checked="true">
                            <label class="divCalLab" for="musica">Música</label><br>
                            <input type="radio" id="teatro" name="category" value="teatro">
                            <label class="divCalLab" for="teatro">Teatro</label><br>
                            <input type="radio" id="danca" name="category" value="danca">
                            <label class="divCalLab" for="danca">Dança</label>
                            <input type="radio" id="palestra" name="category" value="palestra">
                            <label class="divCalLab" for="palestra">Palestra</label>
                        </form>
                    </div>
                </div>
            </div>



        </div>


    </div>
    <div class="divCard" id="divCard">

    </div>

</body>

</html>


<script>
    //aba de descrição
    function show() {
                document.querySelector('.hora').innerHTML = ''
            }
            function hide() {
                document.querySelector('.hora').innerHTML = 'g'
                console.log('FOI')
            }

    var obj = {}

    function mostraEvento(value) {
        let html = '';
        var dias = value.split('/')
       
        rawData = buscaSeteDias(dias[0], dias[1], dias[2])
        rawData.forEach(element => {
            var monthNames= ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro']
            const raw =  Object.values(element.espaco)
           const objraw = raw[0]
           const nomeEspaco = objraw.espaco
           const titulo = element.titulo
           const dataraw = Object.keys(objraw.agenda)
       
           var teste = dataraw[0].split('-')
        
           

    

            html += `<div class="divCard">
                <div class="divCardT">
                    <div style="background-image: url(https://sistemas.cultura.am.gov.br${element.imagem_banner});"
                    class="divCardBack">
                    </div>
                    <div class="Cardif">
                        <div style='background-color:${element.cor};' class="CardDual">
                            <div>
                                <p class="instituicao">Corpo de Dança do Amazonas</p>
                                <h3 class="titulo">${titulo}</h3>
                                <p class="data">${teste[2]} ${monthNames[parseInt(teste[1])-1]} ${teste[0]}<</p>
                                <p class="local">${nomeEspaco}</p>
                                <p class="hora">20h</p>
                                <div class="classif">
                                    <p class="preco">${element.price} Entrada Gratuita</p>
                                    <img class="clasificacao" src="" alt="">
                                </div>
                            </div>
                            <div class="expand" onmouseover="show()" onmouseleave="hide()">
                                <div></div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>`
        });
        document.getElementById('divCard').innerHTML = (html.length > 0) ? html : null;
    }

    function agenda_local(dia, mes, ano) {
        const {
            pautas
        } = obj;
        console.log(dia, mes, ano);
        //console.log(pautas)
        const filterData = Object.values(pautas)
            .filter(pauta => {
                const controleEspaco = Object.values(pauta.espaco).filter(espaco => {
                    const controleAgenda = Object.keys(espaco.agenda).filter(data => data === `${ano}-${mes}-${dia}`);
                    return controleAgenda.length;
                });
                return controleEspaco.length;
            })
        console.log(filterData);

        return filterData;
    }

    function buscaSeteDias(dia, mes, ano) {
        var hoje = new Date
            // var diaHoje = hoje.getDay
            // var mesHoje = hoje.getMonth
        var diaHoje = "1"
        var mesHoje = "02"
        var hojeInteiro = parseInt(diaHoje);

        const {
            pautas
        } = obj;
        const filterData = Object.values(pautas)
            .filter(pauta => {
                const controleEspaco = Object.values(pauta.espaco).filter(espaco => {
                    const controleAgenda = Object.keys(espaco.agenda).filter(data => data > `${ano}-${mesHoje}-${(hojeInteiro - 1).toString()}`).filter(data => data <= `${ano}-${mesHoje}-${(hojeInteiro + 8).toString()}`);
                    return controleAgenda.length;
                });
                return controleEspaco.length;
            })
        console.log(filterData);

        return filterData;
    }

    function buscaTrintaDias(dia, mes, ano) {
        var hoje = new Date
        var diaHoje = hoje.getDay
        var mesHoje = hoje.getMonth

        var hojeInteiro = parseInt(diaHoje);
        var mesInteiro = parseInt(mesHoje);

        const {
            pautas
        } = obj;
        const filterData = Object.values(pautas)
            .filter(pauta => {
                const controleEspaco = Object.values(pauta.espaco).filter(espaco => {
                    const controleAgenda = Object.keys(espaco.agenda).filter(data => data > `${ano}-${mesHoje}-${(hojeInteiro - 1).toString()}`).filter(data => data <= `${ano}-${(mesInteiro + 1).toString()}-${(diaHoje)}`);
                    return controleAgenda.length;
                });
                return controleEspaco.length;
            })
        console.log(filterData);

        return filterData;
    }

    window.onload = async function loadContent() {

        await jQuery.ajax({
            url: 'https://sistemas.cultura.am.gov.br/sigec/api/ListarPautas?type=year&val1=2022',
            data: {
                format: 'json'
            },
            error: function (error) {
                console.log('error', error);
            },
            dataType: 'json',

            success: function (data) {
                Object.assign(obj, data);
                console.log("ok")

            },
            type: 'GET'
        });


    }



    $(function () {
        $("#calendario").datepicker({

            dateFormat: 'dd/mm/yy',
            dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'],
            dayNamesMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S', 'D'],
            dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
            monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],
            monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez']
        });
    });
</script>